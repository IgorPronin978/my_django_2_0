{% load customtags %}
<div class="card">
    <div class="card-body">
        <h5 class="card-title">#{{ article.id }}. {{ article.title }}</h5>
        <p class="card-text">{{ article.content|truncatechars:50 }}</p>
        <p class="card-text">
            <a href="{% url 'news:get_news_by_category' article.category.id %}" class="badge bg-primary">
                {{ article.category.name }}
            </a>
        </p>
        {% for tag in article.tags.all %}
            <a href="{% url 'news:get_news_by_tag' tag.id %}" class="badge bg-info">{{ tag.name }}</a>
        {% endfor %}
        <p class="card-text">{{ article.publication_date }}</p>
        <p class="card-text">Просмотры: {{ article.views }}</p>
        <p class="card-text">Лайки: <span id="likes-count-{{ article.id }}">{{ article.likes_count }}</span></p>
        <button class="btn btn-like {% if article|has_liked:request.META.REMOTE_ADDR %}liked{% endif %}"
                data-article-id="{{ article.id }}"
                onclick="toggleLike({{ article.id }})">
            ❤️
        </button>
        <a href="{% url 'news:detail_article_by_id' article.id %}" class="btn btn-primary">Подробнее</a>
    </div>
</div>

<script>
function toggleLike(articleId) {
    fetch(`/news/toggle_like/${articleId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({})
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById(`likes-count-${articleId}`).textContent = data.likes_count;
        const likeButton = document.querySelector(`button[data-article-id="${articleId}"]`);
        likeButton.classList.toggle('liked', data.liked);
    });
}
</script>

<style>
.btn-like {
    background-color: transparent;
    border: none;
    font-size: 1.5rem;
    color: gray;  <!-- Серый цвет по умолчанию -->
    cursor: pointer;
}

.btn-like.liked {
    color: red;  <!-- Красный цвет, если лайк поставлен -->
}
</style>